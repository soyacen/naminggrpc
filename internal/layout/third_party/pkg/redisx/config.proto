syntax = "proto3";

package grocer.pkg.redisx;
option go_package = "github.com/soyacen/grocer/pkg/redisx;redisx";

import "google/protobuf/duration.proto";
import "google/protobuf/wrappers.proto";
import "pkg/protobufx/tls.proto";

// Configuration for Redis connections
message Config {
  // Map of named Redis configurations
  map<string, Options> configs = 1;
}

// Options for Redis client configuration
message Options {

  // Options specific to Redis cluster connections
  message ClusterOptions {
    // Maximum number of redirects to follow before giving up
    google.protobuf.Int32Value max_redirects    = 1;
    // Enable read-only commands on slave nodes
    google.protobuf.BoolValue  read_only        = 2;
    // Route read-only commands by latency
    google.protobuf.BoolValue  route_by_latency = 3;
    // Route read-only commands randomly among slaves
    google.protobuf.BoolValue  route_randomly   = 4;
  }

  // Options for Redis failover (sentinel) setup
  message FailOverOptions {
    // The sentinel master name.
    google.protobuf.StringValue master_name = 1;
  }

  // Configuration for maintenance notifications
  message MaintNotificationsConfig {
    // Placeholder for maint notifications config
    google.protobuf.BoolValue   enabled = 1;
    // Channel name for maintenance notifications
    google.protobuf.StringValue channel = 2;
  }

  // Either a single address or a seed list of host:port addresses
  // of cluster/sentinel nodes.
  repeated string addrs = 1;

  // client_name will execute the `CLIENT SETNAME ClientName` command for each conn.
  google.protobuf.StringValue client_name = 2;

  // db to be selected after connecting to the server.
  // Only single-node and failover clients.
  google.protobuf.Int32Value db = 3;

  // Common options.
  // Protocol version to use (e.g. 2 or 3 for RESP2 or RESP3)
  google.protobuf.Int32Value  protocol = 4;
  // Username for ACL authentication (Redis 6.0+)
  google.protobuf.StringValue username = 5;
  // Password for authentication
  google.protobuf.StringValue password = 6;

  // Username for sentinel authentication
  google.protobuf.StringValue sentinel_username = 7;
  // Password for sentinel authentication
  google.protobuf.StringValue sentinel_password = 8;

  // Maximum number of retries before giving up
  google.protobuf.Int32Value max_retries       = 9;
  // Minimum backoff between each retry
  google.protobuf.Duration   min_retry_backoff = 10;
  // Maximum backoff between each retry
  google.protobuf.Duration   max_retry_backoff = 11;

  // Timeout for establishing new connections
  google.protobuf.Duration  dial_timeout            = 12;
  // Timeout for socket reads
  google.protobuf.Duration  read_timeout            = 13;
  // Timeout for socket writes
  google.protobuf.Duration  write_timeout           = 14;
  // Enable timeout for context.Ctx values
  google.protobuf.BoolValue context_timeout_enabled = 15;

  // PoolFIFO uses FIFO mode for each node connection pool GET/PUT (default LIFO).
  google.protobuf.BoolValue pool_fifo = 16;

  // Size of connection pool (number of connections)
  google.protobuf.Int32Value pool_size          = 17;
  // Connection age threshold to close connections
  google.protobuf.Duration   pool_timeout       = 18;
  // Minimum number of idle connections
  google.protobuf.Int32Value min_idle_conns     = 19;
  // Maximum number of idle connections
  google.protobuf.Int32Value max_idle_conns     = 20;
  // Maximum number of active connections
  google.protobuf.Int32Value max_active_conns   = 21;
  // Maximum idle time for a connection
  google.protobuf.Duration   conn_max_idle_time = 22;
  // Maximum lifetime for a connection
  google.protobuf.Duration   conn_max_lifetime  = 23;

  // ReadBufferSize is the size of the bufio.Reader buffer for each connection.
  // Larger buffers can improve performance for commands that return large responses.
  // Smaller buffers can improve memory usage for larger pools.
  google.protobuf.Int32Value read_buffer_size = 24;

  // WriteBufferSize is the size of the bufio.Writer buffer for each connection.
  // Larger buffers can improve performance for large pipelines and commands with many arguments.
  // Smaller buffers can improve memory usage for larger pools.
  google.protobuf.Int32Value write_buffer_size = 25;

  // TLS configuration for encrypted connections
  protobufx.TLSOptions tls_config = 26;

  // Only cluster clients.
  ClusterOptions cluster_options = 27;

  // Only failover clients.
  FailOverOptions failover_options = 28;

  // Disable client identity tracking
  google.protobuf.BoolValue   disable_identity = 29;
  // Suffix to append to client identity
  google.protobuf.StringValue identity_suffix  = 30;

  // FailingTimeoutSeconds is the timeout in seconds for marking a cluster node as failing.
  google.protobuf.Int32Value failing_timeout_seconds = 31;

  // Enable experimental RESP3 support
  google.protobuf.BoolValue unstable_resp3 = 32;

  // IsClusterMode can be used when only one Addrs is provided (e.g. Elasticache supports setting up cluster mode with configuration endpoint).
  google.protobuf.BoolValue is_cluster_mode = 33;

  // MaintNotificationsConfig provides configuration for maintnotifications upgrades.
  MaintNotificationsConfig maint_notifications_config = 34;

  // Enable tracing for Redis commands
  google.protobuf.BoolValue enable_tracing = 35;
  // Enable metrics collection for Redis operations
  google.protobuf.BoolValue enable_metrics = 36;

}